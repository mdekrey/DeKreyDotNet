---
import Layout from '@/components/layout.astro';
import { toSummary } from '@/articles/summary';
import IntroBlock from '@/components/intro-block.astro';
import { getArticlesPage, getCountByTag } from '@/articles/pages';
import BlogPostList from '@/articles/blog-post-list.astro';
import { twMerge } from 'tailwind-merge';

const pageInfo = await getArticlesPage(1);
const tags = await getCountByTag();

const posts = pageInfo?.articles.map(toSummary) ?? [];
const pageCount = pageInfo?.totalPageCount ?? 0;
---

<Layout title="Home">
	<IntroBlock slot="no-scroll-header" />

	<p class="flex flex-wrap flex-row gap-1 items-baseline">
		{
			Object.entries(tags)
				.sort(
					([tagA, countA], [tagB, countB]) =>
						countB - countA || tagA.localeCompare(tagB),
				)
				.map(([tag, count]) => (
					<a
						class={twMerge(
							'border border-purple-900 bg-purple-100 inline-block rounded-full px-1 mr-1 leading-normal',
							count === 2 && 'text-sm',
							count === 1 && 'text-xs',
						)}
						href={`/articles/tagged/${tag}/page/1/`}
					>
						{tag}
					</a>
				))
		}
	</p>
	<BlogPostList posts={posts} page={1} pageCount={pageCount} />
</Layout>
